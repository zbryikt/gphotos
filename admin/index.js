function repeatString$(e,n){for(var t="";n>0;(n>>=1)&&(e+=e))1&n&&(t+=e);return t}var x$;x$=angular.module("main"),x$.filter("formatdate",function(){return function(e){var n,t,r,a,o,i,u;return e?(n=new Date(e),t=function(e){return(e+"").length<2?"0"+e:e+""},r=t(n.getMonth()+1),a=t(n.getDate()),o=t(n.getHours()),i=t(n.getMinutes()),u=t(n.getSeconds()),r+"/"+a+" "+o+":"+i+":"+u):"N/A"}}),x$.controller("admin",["$scope","$interval","$timeout","$firebaseArray","$firebaseAuth","backend"].concat(function(e,n,t,r,a,o){return e.stream=o.stream,e.user=o.user,o.email("admin@tw-events.com","admin").then(function(n){var t;return e.admin=n,e.vote={start:o.config.start||null,getstart:function(){return this.start?void 0:(this.start=(new Date).getTime(),o.config.start=this.start,o.config.$save())},dur:o.config.dur||120,update:function(){return o.config.dur=this.dur,o.config.$save()}},e.backend=o,e.$watch("backend.config",function(){return e.vote.start=o.config.start||null,e.vote.dur=o.config.dur||120}),e.upload={concurrentCount:2,progress:{},queue:[],current:[],url:"/d/pic",_handler:function(n){var t,r,a=this;return t=/\.([^.]+)$/.exec(n.name),t||(r="image/jpeg"),"jpg"===t[1]&&(r="image/jpeg"),r="image/"+t[1],storage.upload(n,n.name,r,n.base64,function(n,t){return e.$apply(function(){return console.log("[PROGRESS] "+n.name+" / LOADED: "+t.loaded+" / TOTAL: "+t.total+" / SIZE: "+n.size),n.size=t.total,n.progress=t.loaded})}).then(function(){var t,r,o,i,u=[];for(console.log("[UPLOADED] "+n.name+" ("+n.size+")"),n.progress=n.size,t=function(e){return(e+"").length<6?repeatString$("0",6-(e+"").length)+(e+""):e+""},r=0,o=a.current.length;o>r;++r)if(i=r,a.current[i].name===n.name){e.stream.$add({name:a.current[i].name,url:"https://storage.googleapis.com/thumbnail-gphotos/"+a.current[i].name,order:t(e.stream.length)}),a.current.splice(i,1),e.upload.handle();break}return u})},handle:function(e){var n,t,r,a,o,i,u=[];if(null==e&&(e=null),e&&(n=JSON.stringify(e),this.progress[e[0]]=t={name:e[0],size:n.length,data:n,base64:e[1],img:"data:image/png;base64,"+e[1]},this.queue.push(t),console.log("[QUEUEED] "+e[0])),!(this.current.length>=this.concurrentCount)){for(this.current=this.current.concat(this.queue.splice(0,2-this.current.length)),r=0,o=(a=this.current).length;o>r;++r)i=a[r],console.log("[PROCESS] "+i.name),u.push(this._handler(i));return u}}},t=function(n){var t;return console.log("load file "+n.name+" ... "),t=new FileReader,t.onload=function(){return n.name=encodeURIComponent(n.name),e.upload.handle([n.name,btoa(t.result)])},t.readAsBinaryString(n)},$("#files").on("change",function(){var e,n,r,a,o,i,u=[];for(e=$("#files")[0],console.log("[UPLOAD] "+e.files.length+" files.."),n=[],r=0,a=e.files.length;a>r;++r)o=r,i=e.files[o],u.push(t(i));return u}),storage.init()})}));