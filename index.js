function repeatString$(t,e){for(var n="";e>0;(e>>=1)&&(t+=t))1&e&&(n+=t);return n}var x$;x$=angular.module("main",["firebase"]),x$.directive("isotope",function(){return{restrict:"A",link:function(t,e){var n;return n=$(e[0].parentNode.parentNode.parentNode),n.addClass("iso"),"IMG"===e.prop("tagName")?e.load(function(){return n.addClass("iso-show"),t.isotope.ctrl.appended(n[0]),t.$on("$destroy",function(){return t.isotope.ctrl.remove(n[0]),t.isotope.ctrl.layout()})}):(t.isotope.ctrl.appended(e[0].parentNode.parentNode.parentNode),t.$on("$destroy",function(){return t.isotope.ctrl.remove(e[0].parentNode.parentNode.parentNode),t.isotope.ctrl.layout()}))}}}),x$.filter("rank",function(){return function(t){return["1st","2nd","3rd","4th","5th"][t]||t}}),x$.filter("likecheck",function(){return function(t){var e;return function(){var n=[];for(e in t)n.push(e);return n}().filter(function(e){return t[e].value})}}),x$.filter("decode",function(){return function(t){return atob(t)}}),x$.filter("count",function(){return function(t){var e;return function(){var n=[];for(e in t)n.push(e);return n}().filter(function(e){return(t[e]||(t[e]={})).value}).length}}),x$.filter("escape",function(){return function(t){var e,n,r;return t?(e=t.lastIndexOf("/")+1,n=t.substring(0,e),r=t.substring(e),n+""+encodeURIComponent(r)):t}}),x$.service("backend",["$rootScope","$firebaseArray","$firebaseObject","$firebaseAuth"].concat(function(t,e,n,r){var i;return i={inited:!1,scren:[],user:{},auth:{},ref:{},init:function(){var t=this;return this.ref.root=new Firebase("https://gphotos.firebaseio.com/"),this.ref.stream=new Firebase("https://gphotos.firebaseio.com/stream"),this.ref.config=new Firebase("https://gphotos.firebaseio.com/config"),this.auth=r(this.ref.root),this.stream=e(this.ref.stream),this.config=n(this.ref.config),this.user=this.auth.$getAuth(),this.user?this.getinfo():this.auth.$authAnonymously().then(function(e){return t.user=e,t.getinfo()})},updateinfo:function(){var t,e,n,r,i,o,u,s,a;if(this.info){e=[];for(n in(r=this.info).like||(r.like={}))e.push(n);t=e,i=!1;for(n in r=(o=this.info).like||(o.like={}))u=r[n],this.stream.$getRecord(n)||(i=!0,u.value=!1);for(s=0,a=t.length;a>s;++s)n=t[s],((r=this.info).like||(r.like={}))[n].value||(i=!0,delete((r=this.info).like||(r.like={}))[n]);return i?this.info.$save():void 0}},getinfo:function(){var t=this;return this.ref.user=new Firebase("https://gphotos.firebaseio.com/user/"+this.user.uid+"/"),this.info=n(this.ref.user),this.info.$loaded().then(function(){return t.updateinfo(),t.inited=!0})},email:function(t,e){return this.auth.$authWithPassword({email:t,password:e})}},i.inited||i.init(),i})),x$.controller("rank",["$scope","$interval","$timeout","backend"].concat(function(t,e,n,r){var i;return t.backend=r,i=function(){var e;return e=r.stream.map(function(t){var e;return{like:t.like,url:t.url,count:function(){var n=[];for(e in t.like)n.push(e);return n}().filter(function(e){return t.like[e].value}).length}}).filter(function(t){return t.url}),e.sort(function(t,e){return e.count-t.count}),t.stream=e.splice(0,5),t.inited=!0},e(i,2e3),$(window).on("resize",function(){return t.$apply(function(){var e,n;return e=$(".prj-row img").height(),n=$(window).height(),t.prjrowheight=(n-e)/2})}),t.backhome=function(){return window.location.href="/"}})),x$.controller("main",["$scope","$interval","$timeout","$firebaseArray","$firebaseObject","$firebaseAuth","backend"].concat(function(t,e,n,r,i,o,u){var s;return t.backend=u,s=function(t){return t=repeatString$("0",4-(t+"").length)+(t+"")},t.full={photo:null,set:function(t){return this.photo=t,this.show=!0,this},show:!1},t.like=function(e,n,r){var o,s,a,c,f,l,h;if(null==r&&(r=!1),u.user&&e.$id&&!t.tick.end&&t.tick.start){if(t.backend.updateinfo(),o=t.backend.info,s=function(){var t=[];for(a in o.like||(o.like={}))t.push(a);return t}().filter(function(t){return(o.like||(o.like={}))[t].value}).length,c=((f=e.like||(e.like={}))[l=u.user.uid]||(f[l]={})).value,3>s||c||r)try{h=i(new Firebase("https://gphotos.firebaseio.com/stream/"+e.$id+"/like/"+u.user.uid)),h.$loaded().then(function(){var t,n;return h.value=!((t=e.like||(e.like={}))[n=u.user.uid]||(t[n]={})).value,r&&(h.value=!1),h.$save(),(o.like||(o.like={}))[e.$id]={value:h.value,url:e.url},o.$save()})}catch(d){n=d,console.log("['PLUS' EXCEPTION] catched for possibly entry removal"),console.log(n.stack+"")}else t.revote=!0;return n?(n.preventDefault(),n.stopPropagation(),!1):void 0}},t.backtop=function(){return $(document.body).animate({scrollTop:0},"500","swing",function(){})},t.isotope={obj:null,init:function(){return $("#layout")[0]?(t.isotope.ctrl&&t.isotope.ctrl.destroy(),t.isotope.ctrl=new Isotope($("#layout")[0],{itemSelector:".x-card",layoutMode:"masonry",getSortData:{weight:"[data-order]"},sortBy:"weight",sortAscending:!1})):void 0},update:function(){return t.isotope.ctrl?(n(function(){return t.isotope.ctrl.arrange({filter:"*"})},100),n(function(){return t.isotope.ctrl.arrange({filter:"*"})},1e3)):void 0}},t.$watch("backend.stream",function(){return t.lastLength!==t.backend.stream.length&&(t.isotope.update(),t.lastLength=t.backend.stream.length),t.backend.updateinfo()},!0),t.isotope.init(),t.tick={hrs:0,min:0,sec:0,start:null,dur:72e5,end:!1,count:function(){var t;return this.dur=60*(u.config.dur||120)*1e3,this.start=u.config.start,this.start?(t=parseInt((this.dur-((new Date).getTime()-this.start))/1e3),0>t&&(t=0),this.sec=t%60,this.min=parseInt(t/60)%60,this.hrs=parseInt((t-t%3600)/3600),this.end=0>=t):void 0}},t.remove=function(e){var n;return(n=t.backend.stream.$getRecord(e))?t.like(n,null,!0):void 0},e(function(){return t.tick.count()},1e3),t.inited=!0})),window.onSignIn=function(t){var e;return e=t.getBasicProfile()};