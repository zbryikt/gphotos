function repeatString$(e,t){for(var r="";t>0;(t>>=1)&&(e+=e))1&t&&(r+=e);return r}var x$;x$=angular.module("main",["firebase"]),x$.directive("isotope",function(){return{restrict:"A",link:function(e,t){var r;return r=$(t[0].parentNode.parentNode.parentNode),r.addClass("iso"),"IMG"===t.prop("tagName")?t.load(function(){return r.addClass("iso-show"),e.isotope.ctrl.appended(r[0]),e.$on("$destroy",function(){return e.isotope.ctrl.remove(r[0]),e.isotope.ctrl.layout()})}):(e.isotope.ctrl.appended(t[0].parentNode.parentNode.parentNode),e.$on("$destroy",function(){return e.isotope.ctrl.remove(t[0].parentNode.parentNode.parentNode),e.isotope.ctrl.layout()}))}}}),x$.filter("rank",function(){return function(e){return["1st","2nd","3rd","4th","5th"][e]||e}}),x$.filter("likecheck",function(){return function(e){var t;return function(){var r=[];for(t in e)r.push(t);return r}().filter(function(t){return e[t].value})}}),x$.filter("decode",function(){return function(e){return atob(e)}}),x$.filter("count",function(){return function(e){var t;return function(){var r=[];for(t in e)r.push(t);return r}().filter(function(t){return(e[t]||(e[t]={})).value}).length}}),x$.filter("escape",function(){return function(e){var t,r,n;return e?(t=e.lastIndexOf("/")+1,r=e.substring(0,t),n=e.substring(t),r+""+encodeURIComponent(n)):e}}),x$.service("backend",["$rootScope","$firebaseArray","$firebaseObject","$firebaseAuth"].concat(function(e,t,r,n){var i;return i={inited:!1,scren:[],user:{},auth:{},ref:{},init:function(){var e=this;return this.ref.root=new Firebase("https://gphotos.firebaseio.com/"),this.ref.stream=new Firebase("https://gphotos.firebaseio.com/stream"),this.ref.config=new Firebase("https://gphotos.firebaseio.com/config"),this.auth=n(this.ref.root),this.stream=t(this.ref.stream),this.config=r(this.ref.config),this.user=this.auth.$getAuth(),this.user?this.getinfo():this.auth.$authAnonymously().then(function(t){return e.user=t,e.getinfo()})},getinfo:function(){var e=this;return this.ref.user=new Firebase("https://gphotos.firebaseio.com/user/"+this.user.uid+"/"),this.info=r(this.ref.user),this.info.$loaded().then(function(){return e.inited=!0})},email:function(e,t){return this.auth.$authWithPassword({email:e,password:t})}},i.inited||i.init(),i})),x$.controller("rank",["$scope","$interval","$timeout","backend"].concat(function(e,t,r,n){var i;return e.backend=n,i=function(){var t;return t=n.stream.map(function(e){var t;return{like:e.like,url:e.url,count:function(){var r=[];for(t in e.like)r.push(t);return r}().filter(function(t){return e.like[t].value}).length}}).filter(function(e){return e.url}),t.sort(function(e,t){return t.count-e.count}),e.stream=t.splice(0,5),e.inited=!0},t(i,2e3),$(window).on("resize",function(){return e.$apply(function(){var t,r;return t=$(".prj-row img").height(),r=$(window).height(),e.prjrowheight=(r-t)/2})}),e.backhome=function(){return window.location.href="/"}})),x$.controller("main",["$scope","$interval","$timeout","$firebaseArray","$firebaseObject","$firebaseAuth","backend"].concat(function(e,t,r,n,i,o,u){var s;return e.backend=u,s=function(e){return e=repeatString$("0",4-(e+"").length)+(e+"")},e.full={photo:null,set:function(e){return this.photo=e,this.show=!0,this},show:!1},e.like=function(t,r,n){var o,s,a,c,l,f,h,d,p,g,v,k,$;if(null==n&&(n=!1),u.user&&t.$id&&!e.tick.end&&e.tick.start){o=e.backend.info,function(){var e=[];for(s in o.like||(o.like={}))e.push(s);return e}().filter(function(){return u.stream[s]}),c=[];for(s in o.like||(o.like={}))c.push(s);a=c,console.log(JSON.stringify(a)),l=!1;for(s in f=o.like||(o.like={}))h=f[s],u.stream.$getRecord(s)||(l=!0,h.value=!1,console.log("revoke "+s));for(d=0,p=a.length;p>d;++d)s=a[d],(o.like||(o.like={}))[s].value||(l=!0,delete(o.like||(o.like={}))[s]);if(g=function(){var e=[];for(s in o.like||(o.like={}))e.push(s);return e}().filter(function(e){return(o.like||(o.like={}))[e].value}).length,v=((f=t.like||(t.like={}))[k=u.user.uid]||(f[k]={})).value,l&&o.$save(),console.log(JSON.stringify(function(){var e=[];for(s in o.like||(o.like={}))e.push(s);return e}())),3>g||v||n)try{$=i(new Firebase("https://gphotos.firebaseio.com/stream/"+t.$id+"/like/"+u.user.uid)),$.$loaded().then(function(){var e,r;return $.value=!((e=t.like||(t.like={}))[r=u.user.uid]||(e[r]={})).value,n&&($.value=!1),$.$save(),(o.like||(o.like={}))[t.$id]={value:$.value},o.$save(),console.log("key: ",t.$id),console.log(JSON.stringify(o.like||(o.like={})))})}catch(m){r=m,console.log("['PLUS' EXCEPTION] catched for possibly entry removal"),console.log(r.stack+"")}else e.revote=!0;return r?(r.preventDefault(),r.stopPropagation(),!1):void 0}},e.backtop=function(){return $(document.body).animate({scrollTop:0},"500","swing",function(){})},e.isotope={obj:null,init:function(){return $("#layout")[0]?(e.isotope.ctrl&&e.isotope.ctrl.destroy(),e.isotope.ctrl=new Isotope($("#layout")[0],{itemSelector:".x-card",layoutMode:"masonry",getSortData:{weight:"[data-order]"},sortBy:"weight",sortAscending:!1})):void 0},update:function(){return e.isotope.ctrl?(r(function(){return e.isotope.ctrl.arrange({filter:"*"})},100),r(function(){return e.isotope.ctrl.arrange({filter:"*"})},1e3)):void 0}},e.$watch("backend.stream",function(){return e.lastLength!==e.backend.stream.length?(e.isotope.update(),e.lastLength=e.backend.stream.length):void 0},!0),e.isotope.init(),e.tick={hrs:0,min:0,sec:0,start:null,dur:72e5,end:!1,count:function(){var e;return this.dur=60*(u.config.dur||120)*1e3,this.start=u.config.start,this.start?(e=parseInt((this.dur-((new Date).getTime()-this.start))/1e3),0>e&&(e=0),this.sec=e%60,this.min=parseInt(e/60)%60,this.hrs=parseInt((e-e%3600)/3600),this.end=0>=e):void 0}},e.remove=function(t){var r;return r=e.backend.$getRecord(t),photo?e.like(photo,null,!0):void 0},t(function(){return e.tick.count()},1e3),e.inited=!0})),window.onSignIn=function(e){var t;return t=e.getBasicProfile(),console.log(t)};